{"version":3,"file":"main.min.js","sources":["../src/main.js"],"sourcesContent":["define(\n  ['jquery', 'core/ajax', 'core/notification', 'core/str', 'core/templates', 'core/url', 'core/modal_factory'],\n  function ($, AJAX, NOTIFICATION, STR, TEMPLATES, URL, ModalFactory) {\n    return {\n      searchid: 0, // Ensures that only the last search is shown.\n      loadpositions: {},\n      /*\n      cancelPackageForm: function (url) {\n        STR.get_strings([\n          {'key': 'removal:title', component: 'block_edupublisher'},\n          {'key': 'removal:text', component: 'block_edupublisher'},\n          {'key': 'yes'},\n          {'key': 'no'}\n        ]).done(function (s) {\n            NOTIFICATION.confirm(s[0], s[1], s[2], s[3], function () {\n              top.location.href = url;\n            });\n          }\n        ).fail(NOTIFICATION.exception);\n      },\n      */\n      clickImportConfirmation: function () {\n        $('#page-content div[role=\"main\"] form[action*=\"/edupublisher/pages/import.php\"]').submit();\n      },\n      confirmDeleteGroup: function (url) {\n        STR.get_strings([\n          {'key': 'groups:remove:title', component: 'block_edupublisher'},\n          {'key': 'groups:remove:text', component: 'block_edupublisher'},\n          {'key': 'yes'},\n          {'key': 'no'}\n        ]).done(function (s) {\n            NOTIFICATION.confirm(s[0], s[1], s[2], s[3], function () {\n              top.location.href = url;\n            });\n          }\n        ).fail(NOTIFICATION.exception);\n      },\n      confirmRemoval: function (url) {\n        STR.get_strings([\n          {'key': 'removal:title', component: 'block_edupublisher'},\n          {'key': 'removal:text', component: 'block_edupublisher'},\n          {'key': 'yes'},\n          {'key': 'no'}\n        ]).done(function (s) {\n            NOTIFICATION.confirm(s[0], s[1], s[2], s[3], function () {\n              top.location.href = url;\n            });\n          }\n        ).fail(NOTIFICATION.exception);\n      },\n      exportCourseWarning: function () {\n        var active = $('#id_exportcourse').is(':checked');\n        if (!active) {\n          STR.get_strings([\n            {'key': 'exportcourse', component: 'block_edupublisher'},\n            {'key': 'exportcourse_help', component: 'block_edupublisher'},\n            {'key': 'yes'},\n            {'key': 'no'}\n          ]).done(function (s) {\n              NOTIFICATION.confirm(s[0], s[1], s[2], s[3], function () {\n              }, function () {\n                $('#id_exportcourse').prop('checked', true);\n              });\n            }\n          ).fail(NOTIFICATION.exception);\n        }\n      },\n      initImportSelection: function (packageid, courseid, allowsubcourses) {\n        STR.get_strings([\n          {'key': 'import', component: 'core'},\n        ]).done(function (s) {\n            ModalFactory.create({\n              title: s[0],\n              body: TEMPLATES.render(\n                'block_edupublisher/init_import_selection',\n                {packageid: packageid, courseid: courseid, allowsubcourses: allowsubcourses}\n              ),\n            }).done(function (modal) {\n              modal.show();\n            });\n          }\n        ).fail(NOTIFICATION.exception);\n      },\n      initImportLoadGo: function (uniqid) {\n        var courseid = $('#courseid-' + uniqid).val();\n        var packageid = $('#packageid-' + uniqid).val();\n        var sectionid = $('#sectionid-' + uniqid).val();\n        var assubcourse = $('#assubcourse-' + uniqid).prop('checked') ? 1 : 0;\n        top.location.href = URL.fileUrl(\n          \"/blocks/edupublisher/pages/import.php\",\n          \"?package=\" + packageid + \"&course=\" + courseid + \"&section=\" + sectionid + '&assubcourse=' + assubcourse\n        );\n        // top.location.href = URL.fileUrl(\"/blocks/edupublisher/pages/restore.php\",\n        // \"?package=\" + packageid + \"&course=\" + courseid + \"&section=\" + sectionid + '&assubcourse=' + assubcourse);\n      },\n      /**\n       * Load list of courses we could import to.\n       *\n       * @param {string} uniqid of template.\n       * @param {string} initial course to select initially.\n       */\n      initImportLoadCourses: function (uniqid, initial) {\n        // console.log('MAIN.initIportLoadCourses(uniqid, initial)', uniqid, initial);\n        var MAIN = this;\n        $('#courseid-' + uniqid).empty().attr('disabled', 'disabled');\n        $('#sectionid-' + uniqid).empty().attr('disabled', 'disabled');\n        var packageid = +$('#packageid-' + uniqid).val();\n        STR.get_strings([\n          {'key': 'loading', component: 'core'},\n        ]).done(function (s) {\n            $('#courseid-' + uniqid + ', #sectionid-' + uniqid).append($('<option>').html(s[0]));\n            AJAX.call([{\n              methodname: 'block_edupublisher_init_import_load_courses',\n              args: {packageid: packageid},\n              done: function (result) {\n                // console.log('Result', result);\n                var result = JSON.parse(result);\n                $('#courseid-' + uniqid).empty();\n                if (typeof result.courses !== 'undefined' && Object.keys(result.courses).length > 0) {\n                  $('#courseid-' + uniqid).removeAttr('disabled');\n                  var first = 0;\n                  Object.keys(result.courses).forEach(function (courseid) {\n                    var c = result.courses[courseid];\n                    var opt = $('<option>').attr('value', c.id).html(c.fullname);\n                    $('#courseid-' + uniqid).append(opt);\n                    if (first == 0 && typeof initial !== 'undefined') {\n                      first = c.id;\n                    }\n                    if (typeof initial !== 'undefined' && initial == c.id) {\n                      opt.attr('selected', 'selected');\n                    }\n                  });\n                  MAIN.initImportLoadSections(uniqid);\n                } else {\n                  STR.get_strings([\n                    {'key': 'error', component: 'core'},\n                  ]).done(function (s) {\n                      $('#courseid-' + uniqid).append($('<option>').html(s[0]));\n                      $('#sectionid-' + uniqid).append($('<option>').html(s[0]));\n                    }\n                  ).fail(NOTIFICATION.exception);\n                  NOTIFICATION.show('error', 'no courses');\n                }\n              },\n              fail: NOTIFICATION.exception\n            }]);\n          }\n        ).fail(NOTIFICATION.exception);\n      },\n      initImportLoadSections: function (uniqid) {\n        $('#sectionid-' + uniqid).empty().attr('disabled', 'disabled');\n        STR.get_strings([\n          {'key': 'loading', component: 'core'},\n        ]).done(function (s) {\n            $('#sectionid-' + uniqid).append($('<option>').html(s[0]));\n            AJAX.call([{\n              methodname: 'block_edupublisher_init_import_load_sections',\n              args: {courseid: +$('#courseid-' + uniqid).val()},\n              done: function (result) {\n                // console.log('Result', result);\n                var result = JSON.parse(result);\n                $('#sectionid-' + uniqid).empty();\n                if (typeof result.sections !== 'undefined' && Object.keys(result.sections).length > 0) {\n                  $('#sectionid-' + uniqid).removeAttr('disabled');\n                  var i = 0;\n                  Object.keys(result.sections).forEach(function (sectionid) {\n                    var s = result.sections[sectionid];\n                    if (!s.name) {\n                      s.name = \"#\" + (i);\n                    }\n                    $('#sectionid-' + uniqid).append($('<option>').attr('value', s.id).html(s.name));\n                    i++;\n                  });\n                } else {\n                  STR.get_strings([\n                    {'key': 'error', component: 'core'},\n                  ]).done(function (s) {\n                      $('#sectionid-' + uniqid).append($('<option>').html(s[0]));\n                    }\n                  ).fail(NOTIFICATION.exception);\n                }\n              },\n              fail: NOTIFICATION.exception\n            }]);\n          }\n        ).fail(NOTIFICATION.exception);\n      },\n      injectEnrolButton: function (courseid, isguestuser) {\n        // console.log('MAIN.injectEnrolButton(courseid, isguestuser)', courseid, isguestuser);\n        //if (isguestuser) return;\n        var context = {\n          isguestuser: isguestuser,\n          url: URL.relativeUrl('/blocks/edupublisher/pages/self_enrol.php', {id: courseid}),\n        };\n\n        // This will call the function to load and render our template.\n        TEMPLATES.render('block_edupublisher/inject_enrol_button', context)\n          .then(function (html, js) {\n            // Here eventually I have my compiled template, and any javascript that it generated.\n            // The templates object has append, prepend and replace functions.\n            TEMPLATES.prependNodeContents('#page-content #region-main-box', html, js);\n            // Remove the default course-guestaccess-infobox\n            $('.course-guestaccess-infobox').remove();\n          })\n          .fail(NOTIFICATION.exception);\n      },\n      /*\n      preparePackageForm: function (channels) {\n        // console.log('MAIN.preparePackageForm(channels)', channels);\n        require([\"jquery\"], function ($) {\n          if (typeof channels !== 'undefined') {\n            channels = channels.split(',');\n            for (var a = 0; a < channels.length; a++) {\n              if (channels[a] == 'default') {\n                continue;\n              }\n              // The former one is the checkbox, the latter on the div.\n              if (!$('div[role=\"main\"] #id_' + channels[a] + '_publishas').is(\":checked\")) {\n                $('div[role=\"main\"] #id_' + channels[a] + '_publish_as').css(\"display\", \"none\");\n              } else if ($('div[role=\"main\"] input[name=\"id\"]').val() > 0) {\n                // If id greater 0 and already active disable this box.\n                // $('div[role=\"main\"] #id_' + channels[a] + '_publishas').attr('disabled', 'disabled');\n              }\n            }\n          }\n        });\n      },\n      */\n      search: function (uniqid, courseid, sectionid) {\n        var MAIN = this;\n        // console.log('MAIN.search(uniqid, courseid, sectionid)', uniqid, courseid, sectionid);\n\n        MAIN.watchValue({\n          courseid: courseid,\n          sectionid: sectionid,\n          target: '#' + uniqid + '-search',\n          uniqid: uniqid,\n          run: function () {\n            var o = this;\n            require(['block_edupublisher/main'], function (MAIN) {\n              MAIN.searchNow(o);\n            });\n          }\n        }, 200);\n      },\n      /**\n       * Do the search.\n       * @param {object} o containing courseid, sectionid, target and uniqid.\n       * @param {object} sender html-object that caused the event.\n       */\n      searchNow: function (o, sender) {\n        o.subjectareas = [];\n        o.schoollevels = [];\n        o.stars = [];\n        if (typeof sender !== 'undefined') {\n          if ($(sender).attr('name') == 'subjectarea') {\n            $(sender).toggleClass('selected');\n            $('.' + o.uniqid + '-subjectarea').prop('checked', false);\n            $('.' + o.uniqid + '-subjectarea.selected').prop('checked', true);\n          }\n          if ($(sender).attr('name') == 'schoollevel') {\n            $(sender).toggleClass('selected');\n            $('.' + o.uniqid + '-schoollevel').prop('checked', false);\n            $('.' + o.uniqid + '-schoollevel.selected').prop('checked', true);\n          }\n          if ($(sender).attr('name') == 'stars') {\n            $(sender).toggleClass('selected');\n            $('.' + o.uniqid + '-stars').prop('checked', false);\n            $('.' + o.uniqid + '-stars.selected').prop('checked', true);\n          }\n        }\n        $('.' + o.uniqid + '-subjectarea.selected').each(function () {\n          o.subjectareas[o.subjectareas.length] = $(this).attr('value');\n        });\n        $('.' + o.uniqid + '-schoollevel.selected').each(function () {\n          o.schoollevels[o.schoollevels.length] = $(this).attr('value');\n        });\n        $('.' + o.uniqid + '-stars.selected').each(function () {\n          o.stars[o.stars.length] = $(this).attr('value');\n        });\n        o.search = $('#' + o.uniqid + '-search').val();\n        // Generate object for sending (only some parameters accepted by webservice)\n        var o2 = {\n          courseid: o.courseid,\n          search: o.search,\n          schoollevels: o.schoollevels.join('zzzZZZzzz'),\n          subjectareas: o.subjectareas.join('zzzZZZzzz'),\n          stars: o.stars.join('zzzZZZzzz')\n        };\n        require(['block_edupublisher/main'], function (MAIN) {\n          MAIN.searchid++;\n          var searchid = MAIN.searchid;\n          //console.log('Doing search via ajax for', o2, MAIN.searchid, searchid);\n          AJAX.call([{\n            methodname: 'block_edupublisher_search',\n            args: o2,\n            done: function (result) {\n              if (MAIN.searchid != searchid) {\n                //console.log(' => Got response for searchid ', searchid, ' but it is not the current search', MAIN.searchid);\n              } else {\n                var container = $('#' + o.uniqid + '-filterResults').empty();\n                var result = JSON.parse(result);\n                //console.log('Received', result);\n                $('ul#' + o.uniqid + '-results').empty();\n\n                if (result.packages.length === 0) {\n                  STR.get_strings([\n                    {'key': 'search:enter_term', component: 'block_edupublisher'},\n                  ]).done(function (s) {\n                      $('ul#' + o.uniqid + '-results').append($('<li>').append('<a href=\"#\">').append('<h3>').html(s[0]));\n                    }\n                  ).fail(NOTIFICATION.exception);\n                }\n\n                for (var a = result.packages.length - 1; a >= 0; a--) {\n                  var item = result.packages[a];\n                  item.importtocourseid = o.courseid;\n                  item.importtosectionid = o.sectionid;\n                  item.showpreviewbutton = false;\n                  item.url = M.cfg.wwwroot + '/course/view.php?id=' + item.course;\n                  //console.log('Call list-template for item ', item);\n                  TEMPLATES\n                    .render('block_edupublisher/search_item', item)\n                    .then(function (html, js) {\n                      TEMPLATES.appendNodeContents(container, html, js);\n                    })\n                    .fail(function (ex) {\n                      // eslint-disable-next-line no-console\n                      console.error(ex);\n                    });\n\n                  //MAIN.searchTemplate(container, 'block_edupublisher/search_item', item);\n                }\n              }\n            },\n            fail: NOTIFICATION.exception\n          }]);\n        });\n      },\n      /**\n       * Print all items that are loaded in listpositions.\n       * @param {string} uniqid\n       */\n      searchPrint: function (uniqid) {\n        var MAIN = this;\n        var ok = true;\n        var positions = Object.keys(MAIN.loadpositions[uniqid]);\n\n        for (var a = 0; a < positions.length; a++) {\n          var position = positions[a];\n          if (!MAIN.loadpositions[uniqid][position]) {\n            ok = false;\n          }\n        }\n\n        if (ok) {\n          // Everything was loaded!\n          for (var a = 0; a < positions.length; a++) {\n            var position = positions[a];\n            TEMPLATES.appendNodeContents('ul#' + uniqid + '-results',\n              MAIN.loadpositions[uniqid][position].html,\n              MAIN.loadpositions[uniqid][position].js\n            );\n          }\n        }\n      },\n      /**\n       * Loads a specific template.\n       * @param {any} uniqid\n       * @param {any} position\n       * @param {any} template\n       * @param {any} o\n       */\n      searchTemplate: function (uniqid, position, template, o) {\n        // console.log('Call template', template, ' for object ', o);\n        var MAIN = this;\n        if (typeof MAIN.loadpositions[uniqid] === 'undefined') {\n          MAIN.loadpositions[uniqid] = [];\n        }\n        MAIN.loadpositions[uniqid][position] = false;\n        TEMPLATES\n          .render(template, o)\n          .then(function (html, js) {\n            //console.log('Received a template', template, ' for object', o);\n            MAIN.loadpositions[uniqid][position] = {html: html, js: js};\n            MAIN.searchPrint(uniqid);\n            //templates.appendNodeContents('ul#' + o.uniqid + '-results', html, js);\n          })\n          .fail(function (ex) {\n            // eslint-disable-next-line no-console\n            console.error(ex);\n          });\n      },\n      storePublisher: function (uniqid, sender) {\n        var self = this;\n        var active = $('#active-' + uniqid).prop('checked') ? 1 : 0;\n        var id = parseInt($('#id-' + uniqid).val());\n        var name = $('#name-' + uniqid).val();\n        var mail = $('#mail-' + uniqid).val();\n        if (name.length == 0) {\n          return;\n        }\n        var data = {active: active, id: id, name: name, mail: mail};\n        //console.log(data, sender);\n        AJAX.call([{\n          methodname: 'block_edupublisher_store_publisher',\n          args: data,\n          done: function (result) {\n            try {\n              result = JSON.parse(result);\n              var publishers = Object.keys(result);\n              self.triggerConfirm($(sender).closest('tr'), 1, 'success');\n              for (var a = 0; a < publishers.length; a++) {\n                var publisher = result[publishers[a]];\n                var form = $('#publisher-' + publisher.id);\n                if (form.length == 0) {\n                  var form = $('#publisher-0').attr('id', 'publisher-' + publisher.id);\n                  var uniqid = $(form).attr('data-uniqid');\n                  $(form).find('#id-' + uniqid).val(publisher.id);\n                  $(form).find('#edit-' + uniqid + '>*')\n                    .css('opacity', 1)\n                    .attr('href', '/blocks/edupublisher/pages/publishers.php?id=' + publisher.id);\n                  TEMPLATES.render('block_edupublisher/publisher', {id: 0, name: ''})\n                    .then(function (html) {\n                      $(html).insertAfter($('.edupublisher-publishers').last());\n                    }).fail(function (ex) {\n                    NOTIFICATION.exception(ex);\n                  });\n                } else {\n                  // This is an existing item, update it.\n                  var uniqid = $(form).attr('data-uniqid');\n                  $(form).find('#active-' + uniqid).prop('checked', publisher.active);\n                  $(form).find('#name-' + uniqid).val(publisher.name);\n                  $(form).find('#mail-' + uniqid).val(publisher.mail);\n                }\n\n              }\n            } catch (e) {\n              // eslint-disable-next-line no-console\n              console.error('Invalid response');\n              self.triggerConfirm($(sender).closest('tr'), 1, 'error');\n            }\n          },\n          fail: NOTIFICATION.exception\n        }]);\n      },\n      storePublisherUsers: function (uniqid, action) {\n        var publisherid = $('#publisherid-' + uniqid).val();\n        var userids = '';\n        if (action == 'add') {\n          userids = $('#userids-' + uniqid).val();\n        }\n        if (action == 'remove') {\n          userids = $('#users-' + uniqid).val().join(' ');\n        }\n        var data = {action: action, publisherid: publisherid, userids: userids};\n        // console.log(data);\n        AJAX.call([{\n          methodname: 'block_edupublisher_store_publisher_user',\n          args: data,\n          done: function (result) {\n            try {\n              result = JSON.parse(result);\n              // console.log('Response', result);\n              var sel = $('#users-' + uniqid).empty();\n              var users = Object.keys(result);\n              for (var a = 0; a < users.length; a++) {\n                var user = result[users[a]];\n                $(sel).append($('<option>').attr('value', user.id).html(user.fullname));\n              }\n            } catch (e) {\n              // eslint-disable-next-line no-console\n              console.error('Invalid response', e, result);\n            }\n          },\n          fail: NOTIFICATION.exception\n        }]);\n      },\n      triggerActive: function (packageid, type, sender) {\n        // console.log({ packageid: packageid, type: type, to: $(sender).is(':checked') ? 1 : 0 });\n        AJAX.call([{\n          methodname: 'block_edupublisher_trigger_active',\n          args: {packageid: packageid, type: type, to: $(sender).is(':checked') ? 1 : 0},\n          done: function (result) {\n            // console.log(type, result);\n            try {\n              result = JSON.parse(result);\n              var chans = Object.keys(result);\n              for (var a = 0; a < chans.length; a++) {\n                var x = chans[a].split('_');\n                var type = x[0];\n                if (parseInt(result[chans[a]]) == 1) {\n                  $('#channel-' + type).addClass('channel-active').removeClass('channel-inactive');\n                  $('#channel-' + type + '-active').prop('checked', true);\n                } else {\n                  $('#channel-' + type).addClass('channel-inactive').removeClass('channel-active');\n                  $('#channel-' + type + '-active').prop('checked', false);\n                }\n              }\n            } catch (e) {\n              // eslint-disable-next-line no-console\n              console.error('Invalid response');\n            }\n\n            // Not necessary, ui confirms via active/inactive classes\n            //self.triggerConfirm($(sender).parent(), 1, 'success');\n          },\n          fail: NOTIFICATION.exception\n        }]);\n      },\n      triggerRating: function (uniqid, packageid, to) {\n        // console.log({ packageid: packageid, to: to });\n        AJAX.call([{\n          methodname: 'block_edupublisher_rate',\n          args: {packageid: packageid, to: to},\n          done: function (result) {\n            // console.log(packageid, result);\n            $('#' + uniqid + '-ratingcount').html(result.amount);\n            for (var a = 1; a <= 5; a++) {\n              // console.log('Set image of #' + uniqid + '-rating-' + a + 'to /blocks/edupublisher/pix/star_'\n              // + ((result.average >= a) ? 1 : 0) + '_' + ((result.current == a) ? 1 : 0) + '.png');\n              $('#' + uniqid + '-rating-' + a).attr('src',\n                '/blocks/edupublisher/pix/star_' + ((result.average >= a) ? 1 : 0) + '_' + ((result.current == a) ? 1 : 0) + '.png'\n              );\n            }\n          },\n          fail: NOTIFICATION.exception\n        }]);\n      },\n      triggerConfirm: function (sender, step, type) {\n        var self = this;\n        if (step == 1) {\n          $(sender).addClass('block-edupublisher-' + type);\n          setTimeout(function () {\n            self.triggerConfirm(sender, 0, type);\n          }, 2000);\n        } else {\n          $(sender).removeClass('block-edupublisher-' + type);\n        }\n      },\n      watchValue: function (o, interval) {\n        // if (this.debug > 5) console.log('MAIN.watchValue(o, interval)', o, interval);\n        if (typeof interval === 'undefined') {\n          interval = 1000;\n        }\n\n        if ($(o.target).attr('data-iswatched') != '1') {\n          $(o.target).attr('data-iswatched', 1);\n\n          o.interval = setInterval(\n            function () {\n              if ($(o.target).val() == o.compareto) {\n                o.run();\n                clearInterval(o.interval);\n                $(o.target).attr('data-iswatched', 0);\n              } else {\n                o.compareto = $(o.target).val();\n              }\n            },\n            interval\n          );\n        }\n      },\n    };\n  });\n"],"names":["define","$","AJAX","NOTIFICATION","STR","TEMPLATES","URL","ModalFactory","searchid","loadpositions","clickImportConfirmation","submit","confirmDeleteGroup","url","get_strings","component","done","s","confirm","top","location","href","fail","exception","confirmRemoval","exportCourseWarning","is","prop","initImportSelection","packageid","courseid","allowsubcourses","create","title","body","render","modal","show","initImportLoadGo","uniqid","val","sectionid","assubcourse","fileUrl","initImportLoadCourses","initial","MAIN","this","empty","attr","append","html","call","methodname","args","result","JSON","parse","courses","Object","keys","length","removeAttr","first","forEach","c","opt","id","fullname","initImportLoadSections","sections","i","name","injectEnrolButton","isguestuser","context","relativeUrl","then","js","prependNodeContents","remove","search","watchValue","target","run","o","require","searchNow","sender","subjectareas","schoollevels","stars","toggleClass","each","o2","join","container","packages","a","item","importtocourseid","importtosectionid","showpreviewbutton","M","cfg","wwwroot","course","appendNodeContents","ex","console","error","searchPrint","ok","positions","position","searchTemplate","template","storePublisher","self","active","parseInt","mail","data","publishers","triggerConfirm","closest","publisher","form","find","css","insertAfter","last","e","storePublisherUsers","action","publisherid","userids","sel","users","user","triggerActive","type","to","chans","split","addClass","removeClass","triggerRating","amount","average","current","step","setTimeout","interval","setInterval","compareto","clearInterval"],"mappings":"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"}